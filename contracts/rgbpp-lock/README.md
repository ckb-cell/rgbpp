# RGB++ Lock Script

A lock script that transfers cell ownership to a Bitcoin UTXO seal.

## Overview

To comprehend how the RGB++ lock functions, it is essential first to learn how an RGB++ transaction works:

1. RGB++ assets are signified by a Bitcoin UTXO seal with commitment
2. To transfer assets, the owner consumes the UTXO seal and generates a new through broadcasting a Bitcoin transaction
3. The owner subsequently update the corresponding RGB++ cells on CKB by provides the Bitcoin transaction and a SPV proof
4. The RGB++ lock ensures that the following conditions are met:
  1. The Bitcoin transaction mustn't violates the RGB++ protocol
  2. The CKB transaction is replaying the seal commitment on RGB++ cells

Thus, since every RGB++ cell is generated by replaying RGB++ commitments, we can prove ownership of RGB++ assets by verifying RGB++ cells. This can be easily done by leveraging CKB light client and BTC SPV client. In this scenario, the CKB consensus plays the role of CSV (Client Side Verification). If more safety is desired, all history can be downloaded from Bitcoin and CSV can be performed independently.

## Cells

- **RGB++ cells**

  RGB++ cells reside on CKB, but their ownership is delegated to a Bitcoin UTXO seal. The RGB++ lock validates the Bitcoin transaction and confirms that the current unlocking process is replaying the RGB++ commitment.

- **BTCTimeLock cell**

  BTCTimeLock is a time lock used when an owner migrates assets from Bitcoin to CKB. The assets must remain locked for at least six Bitcoin blocks to safeguard them against potential chain reorgs.

- **Bitcoin SPV client**

  A on-chain Bitcoin SPV client ([ckb-bitcoin-spv-contracts](https://github.com/ckb-cell/ckb-bitcoin-spv-contracts))

## Operations

### Mint

Generate a new RGB++ cell bind with a valid BTC UTXO seal.

``` yaml
inputs:
  - cells to provide CKB
outputs:
  - lock:
      code_hash: (RGB++ type_id)
      hash_type: type
      args: btc_txid | out_index
    type: XUDT or other asset types
    data: ...
    capacity: ...
  ...
```

### Transfer

Transfer an RGB++ cell. The `btc_tx` opens the `btc_txid | out_index` seal and generates a new seal at `btc_txid' | out_index'`.

``` yaml
inputs:
  - previous_out_point: (RGB++ cell args=btc_txid | out_index)
outputs:
  - lock:
      code_hash: (RGB++ type_id)
      hash_type: type
      args: btc_txid' | out_index'
    type: XUDT or other asset types
    data: ...
    capacity: ...
  ...
```

### Leap from Bitcoin to CKB

Move an RGB++ cell from Bitcoin to CKB. The BTC timelock can be unlocked once `btc_txid`'s confirmations surpass `after` (at least six).

``` yaml
inputs:
  - previous_out_point: (RGB++ cell args=btc_txid | out_index)
outputs:
  - lock:
      code_hash: (BTC time_lock type_id)
      hash_type: type
      args: lock_script | after=6 | btc_txid
    type: XUDT or other asset types
    data: ...
    capacity: ...
  ...
```
